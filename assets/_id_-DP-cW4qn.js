import{bX as k,ae as q,R as x,S as I,ad as w,G as F,Y as $,W as B,L as e,X as r,az as i,ai as u,V as N,Z as n,aJ as P,aA as Q,af as R,ag as A,bL as E,O as L,am as M}from"./index-BFX8Q0y2.js";import{c as O,b as D,u as T,e as U}from"./index.esm-BWJzKm3A.js";import{b as y}from"./route-block-B_A1xBdJ.js";import{V as X,a as p}from"./VRow-BQCxpa2a.js";import{V as j}from"./VDivider-eRBJ7UUk.js";import{V as z}from"./VForm-9vA2pZ8d.js";import{V as G}from"./VContainer-m5oBEpCP.js";const J={class:"text-center"},W={class:"text-center"},Y={__name:"[id]",setup(Z){const{api:V,apiAuth:b}=M(),_=k(),m=q(),{t:s}=x(),f=I(),g=w(),a=F({_id:"",name:"",price:0,description:"",image:"",sell:!0,category:""});(async()=>{try{const{data:t}=await V.get("/product/"+_.params.id);a.value=t.result,document.title=a.value.name+" | 購物網站"}catch(t){console.log(t),m.push("/")}})();const h=O({quantity:D().typeError(s("product.addCartQuantityInvalid")).required(s("product.addCartQuantityInvalid")).positive(s("product.addCartQuantityInvalid")).integer(s("product.addCartQuantityInvalid"))}),{handleSubmit:S,isSubmitting:v}=T({validationSchema:h,initialValues:{quantity:1}}),d=U("quantity"),C=S(async t=>{var l,c;if(!f.isLoggedIn){m.push("/login");return}try{const{data:o}=await b.patch("/user/cart",{product:a.value._id,quantity:t.quantity});f.cart=o.result,g({text:s("product.addCartSuccess"),snackbarProps:{color:"green"}})}catch(o){console.log(o),g({text:s("api."+(((c=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:c.message)||"unknownError")),snackbarProps:{color:"red"}})}});return(t,l)=>($(),B(L,null,[e(G,null,{default:r(()=>[e(X,null,{default:r(()=>[e(p,{cols:"12"},{default:r(()=>[i("h1",J,u(a.value.name),1)]),_:1}),e(j),e(p,{cols:"12",md:"6"},{default:r(()=>[e(N,{src:a.value.image},null,8,["src"])]),_:1}),e(p,{cols:"12",md:"6"},{default:r(()=>[i("p",null,u(t.$t("productCategory."+a.value.category)),1),i("p",null,u(a.value.price),1),i("p",null,u(a.value.description),1),e(z,{disabled:n(v),onSubmit:P(n(C),["prevent"])},{default:r(()=>[e(Q,{modelValue:n(d).value.value,"onUpdate:modelValue":l[0]||(l[0]=c=>n(d).value.value=c),modelModifiers:{number:!0},type:"number","error-messages":n(d).errorMessage.value},null,8,["modelValue","error-messages"]),e(R,{type:"submit","prepend-icon":"mdi-cart",loading:n(v)},{default:r(()=>[A(u(t.$t("product.addCart")),1)]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1}),e(E,{"model-value":!a.value.sell,class:"align-center justify-center",scrim:"black",opacity:"0.8",persistent:""},{default:r(()=>[i("h1",W,u(t.$t("api.productNotOnSell")),1)]),_:1},8,["model-value"])],64))}};typeof y=="function"&&y(Y);export{Y as default};
