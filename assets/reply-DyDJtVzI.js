import{ad as T,R as E,G as r,o as U,Y as B,W as L,L as a,X as s,az as F,ai as u,af as V,ag as p,ah as N,aA as k,aJ as _,ay as q,av as M,ax as O,aK as h,aL as z,O as G,am as J}from"./index-BFX8Q0y2.js";import{b as $}from"./route-block-B_A1xBdJ.js";import{V as K,a as S}from"./VRow-BQCxpa2a.js";import{V as W}from"./VDivider-eRBJ7UUk.js";import{V as X,a as Y}from"./VDataTable-BRJNP0Tv.js";import{V as j}from"./VToolbar-DDKy6v8W.js";import{V as H}from"./VContainer-m5oBEpCP.js";import{V as Q}from"./VForm-9vA2pZ8d.js";import{V as Z}from"./VTextarea-Cjxf_GLu.js";import"./VPagination-CfouEJKD.js";import"./VList-6P4JW9bb.js";import"./VMenu-C91Thucz.js";const ee={class:"text-center"},ae={__name:"reply",setup(le){const{apiAuth:y}=J(),{createSnackbar:c}=T(),{t:o}=E(),b=r([]),g=r(""),n=r({open:!1,id:""}),f=r(!1),m=r(""),i=r(""),d=r(""),v=r(""),x=r(""),R=r(""),I=[{text:o("reply.statusPending"),value:"pending"},{text:o("reply.statusConfirmed"),value:"confirmed"},{text:o("reply.statusClosed"),value:"closed"}],D=[{text:o("reply.userId"),value:"userId"},{text:o("reply.name"),value:"name"},{text:o("reply.description"),value:"description"},{text:o("reply.status"),value:"status"},{text:o("reply.reportedAt"),value:"reportedAt",sortable:!0},{text:o("reply.fixedAt"),value:"fixedAt",sortable:!0},{text:o("action"),value:"edit",sortable:!1}],w=async()=>{var l,t;try{const{data:e}=await y.get("/reply/all");console.log("API Response:",e),b.value=e.result,console.log("取得的回報資料:",b.value)}catch(e){console.error("API Error:",e),c({text:o("api."+(((t=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:t.message)||"unknownError")),snackbarProps:{color:"red"}})}},C=l=>{l?(n.value.id=l._id,m.value=l.userId,i.value=l.name,d.value=l.description,v.value=l.status):(n.value.id="",m.value="",i.value="",d.value="",v.value=""),n.value.open=!0},A=()=>{n.value.open=!1},P=async()=>{var l,t;try{if(f.value=!0,i.value)x.value="";else{x.value=o("replyReportRequired");return}if(d.value)R.value="";else{R.value=o("replyReportRequired");return}const e={userId:m.value,name:i.value,description:d.value,status:v.value};n.value.id?(await y.patch("/reply/"+n.value.id,e),c({text:o("adminReply.editSuccess"),snackbarProps:{color:"green"}})):(await y.post("/reply",e),c({text:o("adminReply.newSuccess"),snackbarProps:{color:"green"}})),w(),A()}catch(e){c({text:o("api."+(((t=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:t.message)||"unknownError")),snackbarProps:{color:"red"}})}finally{f.value=!1}};return U(w),(l,t)=>(B(),L(G,null,[a(H,null,{default:s(()=>[a(K,null,{default:s(()=>[a(S,{cols:"12"},{default:s(()=>[F("h1",ee,u(l.$t("nav.adminReply")),1)]),_:1}),a(W),a(S,{cols:"12"},{default:s(()=>[a(X,{items:b.value,headers:D,search:g.value},{top:s(()=>[a(j,null,{default:s(()=>[a(V,{onClick:t[0]||(t[0]=e=>C(null))},{default:s(()=>[p(u(l.$t("adminReply.new")),1)]),_:1}),a(N),a(k,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=e=>g.value=e),"prepend-inner-icon":"mdi-magnify",variant:"underlined"},null,8,["modelValue"])]),_:1})]),"item.reportedAt":s(({value:e})=>[p(u(new Date(e).toLocaleString()),1)]),"item.fixedAt":s(({value:e})=>[p(u(e?new Date(e).toLocaleString():"-"),1)]),"item.edit":s(({item:e})=>[a(V,{icon:"mdi-pencil",variant:"text",onClick:te=>C(e)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1})]),_:1})]),_:1}),a(z,{modelValue:n.value.open,"onUpdate:modelValue":t[6]||(t[6]=e=>n.value.open=e),persistent:""},{default:s(()=>[a(Q,{disabled:f.value,onSubmit:_(P,["prevent"])},{default:s(()=>[a(q,null,{default:s(()=>[a(M,null,{default:s(()=>[p(u(l.$t(n.value.id?"adminReply.edit":"adminReply.new")),1)]),_:1}),a(O,null,{default:s(()=>[a(k,{modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=e=>m.value=e),label:l.$t("reply.userId"),disabled:""},null,8,["modelValue","label"]),a(k,{modelValue:i.value,"onUpdate:modelValue":t[3]||(t[3]=e=>i.value=e),label:l.$t("reply.name"),"error-messages":x.value},null,8,["modelValue","label","error-messages"]),a(Z,{modelValue:d.value,"onUpdate:modelValue":t[4]||(t[4]=e=>d.value=e),label:l.$t("reply.description"),"error-messages":R.value},null,8,["modelValue","label","error-messages"]),a(Y,{modelValue:v.value,"onUpdate:modelValue":t[5]||(t[5]=e=>v.value=e),items:I,label:l.$t("reply.status")},null,8,["modelValue","label"])]),_:1}),a(h,null,{default:s(()=>[a(V,{onClick:A},{default:s(()=>[p(u(l.$t("adminReply.cancel")),1)]),_:1}),a(V,{type:"submit",loading:f.value},{default:s(()=>[p(u(l.$t("adminReply.submit")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled"])]),_:1},8,["modelValue"])],64))}};typeof $=="function"&&$(ae);export{ae as default};
