import{R as z,ad as E,aI as L,G as c,c as j,U as _,Y as D,W as G,L as t,X as o,ag as J,aj as d,af as k,ai as m,ah as K,aB as F,V as O,$ as W,ak as X,Z as n,aJ as Y,aA as Z,ax as H,ay as Q,az as ee,aK as ae,O as te,an as le,ac as oe}from"./index-CsVGTTef.js";import{c as re,a as R,d as se,u as ne,e as $}from"./index.esm-BcoJPNkm.js";import{b as T}from"./route-block-B_A1xBdJ.js";import{V as ie,a as U}from"./VRow-DUbsh6-A.js";import{V as ue}from"./VDivider-3wSq5W2s.js";import{V as de}from"./VDataTable-BHaLJHLD.js";import{V as me}from"./VToolbar--WJ6ha7m.js";import{V as pe}from"./VContainer-BdD9yQ9D.js";import{V as ce}from"./VForm-CZEn2tX5.js";import{V as ge}from"./VCheckbox-OiT88zPs.js";import{V as fe}from"./VTextarea-Dt8VOjgm.js";import"./sort-zVflryhc.js";import"./VPagination-aLLJiE4p.js";import"./VList-CCNEPe3X.js";import"./VListItem-CifMXZEl.js";import"./VMenu-BQsD6w_X.js";import"./VChip-DaGP431G.js";const ve={class:"text-center"},Ve={__name:"products",setup(be){const{t:r}=z(),{apiAuth:y}=le(),g=E(),f=L([]),w=c(""),q=j(()=>[{title:"ID",key:"_id",sortable:!0},{title:r("product.image"),key:"image",sortable:!1},{title:r("product.name"),key:"name",sortable:!0},{title:r("product.description"),key:"description",sortable:!0},{title:r("product.sell"),key:"sell",sortable:!0},{title:r("product.createdAt"),key:"createdAt",sortable:!0},{title:r("product.updatedAt"),key:"updatedAt",sortable:!0},{title:r("adminProduct.edit"),key:"edit",sortable:!1}]),h=async()=>{var a,l;try{const{data:u}=await y.get("/product/all");f.push(...u.result)}catch(u){console.log(u),g({text:r("api."+(((l=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:l.message)||"unknownError")),snackbarProps:{color:"red"}})}};h();const i=c({open:!1,id:""}),A=a=>{a&&(i.value.id=a._id,v.value.value=a.name,V.value.value=a.description,b.value.value=a.sell),i.value.open=!0},C=()=>{M(),i.value.id="",i.value.open=!1,P.value.deleteFileRecord()},B=re({name:R().required(r("api.productNameRequired")),description:R().required(r("api.productDescriptionRequired")),sell:se().required(r("api.productSellRequired"))}),{handleSubmit:I,isSubmitting:S,resetForm:M}=ne({validationSchema:B,initialValues:{name:"",description:"",category:"",sell:!1}}),v=$("name"),V=$("description"),b=$("sell"),P=c(null),p=c([]),x=c([]),N=I(async a=>{var l,u,e;if(!((l=p.value[0])!=null&&l.error)){if(i.value.id.length===0&&p.value.length===0){g({text:r("api.productImageRequired"),snackbarProps:{color:"red"}});return}try{const s=new FormData;s.append("name",a.name),s.append("description",a.description),s.append("sell",a.sell),p.value.length>0&&s.append("image",p.value[0].file),i.value.id.length>0?await y.patch("/product/"+i.value.id,s):await y.post("/product",s),f.splice(0,f.length),h(),g({text:r(i.value.id.length>0?"adminProduct.editSuccess":"adminProduct.newSuccess"),snackbarProps:{color:"green"}}),C()}catch(s){console.log(s),g({text:r("api."+(((e=(u=s==null?void 0:s.response)==null?void 0:u.data)==null?void 0:e.message)||"unknownError")),snackbarProps:{color:"red"}})}}});return(a,l)=>{const u=_("VueFileAgent");return D(),G(te,null,[t(pe,null,{default:o(()=>[t(ie,null,{default:o(()=>[t(U,{cols:"12"},{default:o(()=>[J("h1",ve,d(a.$t("nav.adminExplore")),1)]),_:1}),t(ue),t(U,{cols:"12"},{default:o(()=>[t(de,{items:f,headers:q.value,search:w.value},{top:o(()=>[t(me,null,{default:o(()=>[t(k,{onClick:l[0]||(l[0]=e=>A(null))},{default:o(()=>[m(d(a.$t("adminProduct.new")),1)]),_:1}),t(K),t(F,{modelValue:w.value,"onUpdate:modelValue":l[1]||(l[1]=e=>w.value=e),"prepend-inner-icon":"mdi-magnify",variant:"underlined"},null,8,["modelValue"])]),_:1})]),"item.image":o(({value:e})=>[t(O,{src:e,height:"50"},null,8,["src"])]),"item.sell":o(({value:e})=>[e?(D(),W(oe,{key:0,icon:"mdi-check"})):X("",!0)]),"item.createdAt":o(({value:e})=>[m(d(new Date(e).toLocaleString()),1)]),"item.updatedAt":o(({value:e})=>[m(d(new Date(e).toLocaleString()),1)]),"item.category":o(({value:e})=>[m(d(a.$t("productCategory."+e)),1)]),"item.edit":o(({item:e})=>[t(k,{icon:"mdi-pencil",variant:"text",onClick:s=>A(e)},null,8,["onClick"])]),_:2},1032,["items","headers","search"])]),_:1})]),_:1})]),_:1}),t(ae,{modelValue:i.value.open,"onUpdate:modelValue":l[7]||(l[7]=e=>i.value.open=e),persistent:""},{default:o(()=>[t(ce,{disabled:n(S),onSubmit:Y(n(N),["prevent"])},{default:o(()=>[t(Z,null,{default:o(()=>[t(H,null,{default:o(()=>[m(d(a.$t(i.value.id?"adminProduct.edit":"adminProduct.new")),1)]),_:1}),t(Q,null,{default:o(()=>[t(F,{modelValue:n(v).value.value,"onUpdate:modelValue":l[2]||(l[2]=e=>n(v).value.value=e),label:a.$t("product.name"),"error-messages":n(v).errorMessage.value},null,8,["modelValue","label","error-messages"]),t(ge,{modelValue:n(b).value.value,"onUpdate:modelValue":l[3]||(l[3]=e=>n(b).value.value=e),label:a.$t("product.onSell"),"error-messages":n(b).errorMessage.value},null,8,["modelValue","label","error-messages"]),t(fe,{modelValue:n(V).value.value,"onUpdate:modelValue":l[4]||(l[4]=e=>n(V).value.value=e),label:a.$t("product.description"),"error-messages":n(V).errorMessage.value},null,8,["modelValue","label","error-messages"]),t(u,{ref_key:"fileAgent",ref:P,modelValue:p.value,"onUpdate:modelValue":l[5]||(l[5]=e=>p.value=e),"raw-model-value":x.value,"onUpdate:rawModelValue":l[6]||(l[6]=e=>x.value=e),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":a.$t("fileAgent.helpText"),"error-text":{type:a.$t("fileAgent.errorType"),size:a.$t("fileAgent.errorSize")}},null,8,["modelValue","raw-model-value","help-text","error-text"])]),_:1}),t(ee,null,{default:o(()=>[t(k,{onClick:C},{default:o(()=>[m(d(a.$t("adminProduct.cancel")),1)]),_:1}),t(k,{type:"submit",loading:n(S)},{default:o(()=>[m(d(a.$t("adminProduct.submit")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof T=="function"&&T(Ve);export{Ve as default};
